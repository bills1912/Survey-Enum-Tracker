<analysis>
The trajectory details an intensive development and debugging cycle for a field data collection application. The initial phase focused on core features, but the work quickly shifted to resolving a series of critical issues reported by the user.

A major data loss incident occurred when a seeding script () wiped the database. This was resolved by creating and running a  script that salvaged existing survey data and reconstructed related user and respondent information.

The most persistent challenge has been the user's inability to connect to the application via Expo Go. This was traced to the cloud Kubernetes environment, where the embedded ngrok tunnel in Expo's CI mode fails to correctly generate or expose the  URL. Despite numerous attempts to fix environment variables, restart services, and clear caches, the issue remained. This led to a strategic pivot: guiding the user to build a standalone APK using Expo Application Services (EAS), which involved creating , installing , and providing detailed build instructions.

Alongside this, several UI/UX bugs and feature requests were addressed:
1.  Fixing a login redirect to a non-existent dashboard.
2.  Patching crashes on the Map and List views due to data structure inconsistencies after the data restore.
3.  Adjusting the bottom tab bar to accommodate system navigation buttons.
4.  Implementing a sophisticated offline synchronization mechanism for location tracking.
5.  Completely redesigning the logout confirmation from a standard modal to a compact, aesthetic bottom sheet as requested by the user.

The user's language is **Bahasa Indonesia**. The next agent must respond in **Bahasa Indonesia**.
</analysis>

<product_requirements>
The goal is to build a multi-user, real-time device tracking application for monitoring field data collection activities, with a strong emphasis on offline capabilities.

**Core Components:**
*   **Mobile App (React Native/Expo):** For Enumerators and Supervisors to conduct surveys, track their location, update respondent status, and communicate via chat. The app must function reliably in areas with poor or no internet connectivity.
*   **Backend (FastAPI/MongoDB):** To manage users, surveys, respondents, and real-time location data.
*   **Web Dashboard:** For administrative overview and user management.

**Key Features & Recent Implementations:**
*   **Real-time & Offline Tracking:** Location data is tracked and visualized on a map. A new offline synchronization system has been implemented to queue location updates and other data, syncing automatically when connectivity is restored.
*   **UI/UX Enhancements:**
    *   The app icon was updated.
    *   The logout confirmation was redesigned from a central modal to a compact, non-intrusive bottom sheet with a numeric-only keyboard, as per user's visual reference.
*   **Bug Fixes:** Resolved data loss, fixed crashes on map/list views post-data-restore, and corrected login redirection.
*   **Build Process:** Shifted from relying on Expo Go (due to persistent environment issues) to building a standalone production APK via EAS Build.
</product_requirements>

<key_technical_concepts>
- **Full-Stack:** Expo (React Native), FastAPI (Python), MongoDB.
- **Authentication:** JWT (JSON Web Tokens).
- **Build/Deployment:** Expo Application Services (EAS) for building standalone APKs.
- **Offline Synchronization:** Using  to queue data (locations, etc.) and a custom  with retry logic to send data to the backend when online.
- **Keyboard Handling:**  to prevent keyboard from obscuring input fields, a recurring focus for UI refinement.
- **UI Components:** Use of custom Modals and the implementation of a Bottom Sheet for improved UX.
</key_technical_concepts>

<code_architecture>
The project is a monorepo with  and  directories.



-   ****
    -   **Importance:** A critical one-off script created to fix a major data loss incident.
    -   **Summary of changes:** Created from scratch to read existing surveys, recreate users (admin, supervisors, enumerators) with new s, and then repopulate respondents and locations, associating them with the newly created user IDs. This saved the project's historical data.

-   ****
    -   **Importance:** Core configuration file for the Expo app.
    -   **Summary of changes:** Heavily modified to fix multiple issues.
        1.  The  and  paths were updated to use a new icon derived from the splash screen image.
        2.  Added  configuration (, , ) to enable EAS Updates (OTA).
        3.  Added iOS-specific configurations (, permission strings) to prepare for an iOS build.

-   ****
    -   **Importance:** Defines build profiles for Expo Application Services (EAS).
    -   **Summary of changes:** Created from scratch to facilitate building a standalone APK, bypassing the problematic Expo Go environment. It contains , , and  profiles, with the latter configured for a fully standalone app ().

-   ****
    -   **Importance:** Contains user profile information and the logout functionality.
    -   **Summary of changes:** The logout confirmation was completely refactored. The original  was replaced with a custom bottom sheet implementation that is minimal, appears from the bottom, and uses a  to ensure the numeric input for the logout code is always visible above the keyboard, matching the user's provided screenshots.

-   ****
    -   **Importance:** The form for adding new survey respondents.
    -   **Summary of changes:** The  function was fixed to send the correct data structure to the backend. It now includes the required , formats  as an object, and includes new optional fields (, ) in the payload. The UI was also updated to include input fields for phone and address.

-   ****
    -   **Importance:** The in-app messaging screen.
    -   **Summary of changes:** This file is the subject of the current work. The user reported that the keyboard covers the text input. An initial fix was attempted, but the user requested a more polished behavior similar to modern chat apps. The last action was refactoring the JSX to wrap the entire screen content in a  with a more robust structure.
</code_architecture>

<pending_tasks>
- **Finalize Chat Keyboard Fix:** Complete the refactor of  by adding the necessary styles to ensure the input field slides up smoothly above the keyboard.
- **Implement Survey Detail Screen:** The  screen is still a placeholder and needs to be fully implemented.
- **End-to-End Testing:** The offline synchronization feature needs to be thoroughly tested by the user in a real-world scenario (by building the APK). The bulk user upload feature also needs testing.
</pending_tasks>

<current_work>
The AI engineer was actively fixing a UI/UX bug on the chat screen (). The user reported that the keyboard obscures the text input field, making it impossible to see what is being typed. The user explicitly requested a behavior similar to modern chat applications like Gemini or OpenAI, where the input field smoothly slides up and remains visible above the keyboard.

The previous engineer identified that the existing  implementation was suboptimal. A significant refactoring of the component's structure was started. The last action taken was editing  to wrap the entire screen—the message list () and the input bar ()—within a single, top-level . This sets up the correct structure, but the styling adjustments to make it work have not yet been applied. The next step is to add the necessary styles to the  and its child components to achieve the desired smooth slide up effect.
</current_work>

<optional_next_step>
Continue fixing the chat screen keyboard issue by adding the necessary styles to the newly refactored  in  to finalize the smooth slide-up behavior.
</optional_next_step>
