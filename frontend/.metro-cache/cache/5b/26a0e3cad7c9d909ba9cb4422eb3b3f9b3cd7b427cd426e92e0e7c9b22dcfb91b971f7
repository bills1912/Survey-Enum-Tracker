{"dependencies":[{"name":"expo-location","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"GNP7AGCKsBRUhlnTZ4lIPpbkT9E=","exportNames":["*"],"imports":1}},{"name":"expo-task-manager","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":44},"end":{"line":2,"column":49,"index":93}}],"key":"bYMruywqSxptqIFJf3NLT25O6Io=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":95},"end":{"line":3,"column":36,"index":131}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}},{"name":"./storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":133},"end":{"line":4,"column":43,"index":176}}],"key":"3rLtLV8J3gSw9c8Ep8Wpc3w/Yxg=","exportNames":["*"],"imports":1}},{"name":"@react-native-community/netinfo","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":178},"end":{"line":5,"column":54,"index":232}}],"key":"PqZcYTlMIVnzFjdViPzMiGUu7Hg=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,_e,_d){\"use strict\";function o(o){if(o&&o.__esModule)return o;var t={};return o&&Object.keys(o).forEach(function(e){var n=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(t,e,n.get?n:{enumerable:!0,get:function(){return o[e]}})}),t.default=o,t}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,\"locationTrackingService\",{enumerable:!0,get:function(){return y}});var t,e=o(r(_d[0])),n=o(r(_d[1])),c=r(_d[2]),s=r(_d[3]),l=r(_d[4]),d=(t=l)&&t.__esModule?t:{default:t};const u='background-location-task',y={async requestPermissions(){const{status:o}=await e.requestForegroundPermissionsAsync();if('granted'!==o)throw new Error('Location permission not granted');const{status:t}=await e.requestBackgroundPermissionsAsync();return'granted'!==t&&console.warn('Background location permission not granted'),{foreground:'granted'===o,background:'granted'===t}},async startTracking(o){try{if(!(await this.requestPermissions()).foreground)throw new Error('Location permission required');await e.startLocationUpdatesAsync(u,{accuracy:e.Accuracy.High,timeInterval:3e5,distanceInterval:0,foregroundService:{notificationTitle:'Field Data Collection',notificationBody:'Tracking your location for field work monitoring'}}),console.log('Location tracking started')}catch(o){throw console.error('Error starting location tracking:',o),o}},async stopTracking(){try{await e.hasStartedLocationUpdatesAsync(u)&&(await e.stopLocationUpdatesAsync(u),console.log('Location tracking stopped'))}catch(o){console.error('Error stopping location tracking:',o)}},async getCurrentLocation(){try{return await e.getCurrentPositionAsync({accuracy:e.Accuracy.High})}catch(o){throw console.error('Error getting current location:',o),o}},async syncPendingLocations(){try{if(!(await d.default.fetch()).isConnected)return void console.log('No internet connection, skipping sync');const o=await s.storageService.getPendingLocations();if(0===o.length)return;console.log(`Syncing ${o.length} pending locations`),await c.locationAPI.createLocationsBatch(o),await s.storageService.clearPendingLocations(),console.log('Locations synced successfully')}catch(o){console.error('Error syncing locations:',o)}}};n.defineTask(u,async({data:o,error:t})=>{if(t)console.error('Background location task error:',t);else if(o){const{locations:e}=o,n=await s.storageService.getUser();if(!n||0===e.length)return;const l=e[0],u={user_id:n.id,latitude:l.coords.latitude,longitude:l.coords.longitude,timestamp:new Date(l.timestamp).toISOString()};try{(await d.default.fetch()).isConnected?(await c.locationAPI.createLocation(u),console.log('Location sent to server')):(await s.storageService.savePendingLocation(u),console.log('Location saved locally (offline)'))}catch(t){await s.storageService.savePendingLocation(u),console.error('Error sending location, saved locally:',t)}}})});","lineCount":1,"map":[[1,327,10,0,"Object"],[1,334,10,0,"defineProperty"],[1,349,10,0,"_e"],[1,352,10,0],[1,379,10,0,"enumerable"],[1,391,10,0],[1,393,10,0,"get"],[1,397,10,0],[1,415,10,0,"locationTrackingService"],[1,416,10,0],[1,420,1,0],[1,424],[1,426,1,0,"Location"],[1,428,1,0,"_interopNamespace"],[1,430,1,0,"r"],[1,432,1,0,"_d"],[1,435,1,0],[1,440,2,0,"TaskManager"],[1,442,2,0,"_interopNamespace"],[1,444,2,0,"r"],[1,446,2,0,"_d"],[1,449,2,0],[1,454,3,0,"_api"],[1,456,3,0,"r"],[1,458,3,0,"_d"],[1,461,3,0],[1,465,4,0,"_storage"],[1,467,4,0,"r"],[1,469,4,0,"_d"],[1,472,4,0],[1,476,5,0,"_reactNativeCommunityNetinfo"],[1,478,5,0,"r"],[1,480,5,0,"_d"],[1,483,5,0],[1,487,5,0,"NetInfo"],[1,490],[1,492,5,0,"_reactNativeCommunityNetinfo"],[1,496],[1,523,7,0],[1,529,7,6,"LOCATION_TASK_NAME"],[1,531,7,27],[1,558,10,13,"locationTrackingService"],[1,560,10,39],[1,561,11,2],[1,585,11,8,"requestPermissions"],[1,588,12,4],[1,594,12,12,"status"],[1,601,12,20,"foregroundStatus"],[1,610,12,47,"Location"],[1,612,12,56,"requestForegroundPermissionsAsync"],[1,648,13,4],[1,651,13,29],[1,663,13,8,"foregroundStatus"],[1,665,14,6],[1,671,14,12],[1,675,14,16,"Error"],[1,681,14,22],[1,716,17,4],[1,722,17,12,"status"],[1,729,17,20,"backgroundStatus"],[1,738,17,47,"Location"],[1,740,17,56,"requestBackgroundPermissionsAsync"],[1,776,22,4],[1,782,18,29],[1,794,18,8,"backgroundStatus"],[1,797,19,6,"console"],[1,805,19,14,"warn"],[1,810,19,19],[1,856,22,11],[1,857,22,13,"foreground"],[1,868,22,46],[1,880,22,25,"foregroundStatus"],[1,882,22,57,"background"],[1,893,22,90],[1,905,22,69,"backgroundStatus"],[1,907,23,2],[1,909,25,2],[1,928,25,8,"startTracking"],[1,929,25,22,"userId"],[1,932,26,4],[1,936,28,6],[1,947,27,32,"this"],[1,952,27,37,"requestPermissions"],[1,974,28,23,"foreground"],[1,985,29,8],[1,991,29,14],[1,995,29,18,"Error"],[1,1001,29,24],[1,1039,33,12,"Location"],[1,1041,33,21,"startLocationUpdatesAsync"],[1,1067,33,47,"LOCATION_TASK_NAME"],[1,1069,33,67],[1,1070,34,8,"accuracy"],[1,1079,34,18,"Location"],[1,1081,34,27,"Accuracy"],[1,1090,34,36,"High"],[1,1095,35,8,"timeInterval"],[1,1108,8,23],[1,1112,36,8,"distanceInterval"],[1,1129,36,26],[1,1131,37,8,"foregroundService"],[1,1149,37,27],[1,1150,38,10,"notificationTitle"],[1,1168,38,29],[1,1192,39,10,"notificationBody"],[1,1209,39,28],[1,1263,43,6,"console"],[1,1271,43,14,"log"],[1,1275,43,18],[1,1303,44,4],[1,1304,44,6],[1,1310,44,13,"error"],[1,1313,46,6],[1,1319,45,6,"console"],[1,1327,45,14,"error"],[1,1333,45,20],[1,1369,45,57,"error"],[1,1372,46,12,"error"],[1,1373,47,4],[1,1374,48,2],[1,1376,50,2],[1,1394,50,8,"stopTracking"],[1,1397,51,4],[1,1407,52,31,"Location"],[1,1409,52,40,"hasStartedLocationUpdatesAsync"],[1,1440,52,71,"LOCATION_TASK_NAME"],[1,1451,54,14,"Location"],[1,1453,54,23,"stopLocationUpdatesAsync"],[1,1478,54,48,"LOCATION_TASK_NAME"],[1,1481,55,8,"console"],[1,1489,55,16,"log"],[1,1493,55,20],[1,1522,57,4],[1,1523,57,6],[1,1529,57,13,"error"],[1,1532,58,6,"console"],[1,1540,58,14,"error"],[1,1546,58,20],[1,1582,58,57,"error"],[1,1584,59,4],[1,1585,60,2],[1,1587,62,2],[1,1611,62,8,"getCurrentLocation"],[1,1614,63,4],[1,1618,67,6],[1,1631,64,29,"Location"],[1,1633,64,38,"getCurrentPositionAsync"],[1,1657,64,62],[1,1658,65,8,"accuracy"],[1,1667,65,18,"Location"],[1,1669,65,27,"Accuracy"],[1,1678,65,36,"High"],[1,1684,68,4],[1,1685,68,6],[1,1691,68,13,"error"],[1,1694,70,6],[1,1700,69,6,"console"],[1,1708,69,14,"error"],[1,1714,69,20],[1,1748,69,55,"error"],[1,1751,70,12,"error"],[1,1752,71,4],[1,1753,72,2],[1,1755,74,2],[1,1781,74,8,"syncPendingLocations"],[1,1784,75,4],[1,1788,77,6],[1,1799,76,28,"NetInfo"],[1,1801,76,35,"default"],[1,1809,76,36,"fetch"],[1,1818,77,19,"isConnected"],[1,1830,79,8],[1,1842,78,8,"console"],[1,1850,78,16,"log"],[1,1854,78,20],[1,1895,82,6],[1,1901,82,12,"pendingLocations"],[1,1909,82,37,"storageService"],[1,1911,82,51,"storageService"],[1,1926,82,52,"getPendingLocations"],[1,1948,83,6],[1,1951,83,38],[1,1955,83,10,"pendingLocations"],[1,1957,83,27,"length"],[1,1964,84,8],[1,1971,87,6,"console"],[1,1979,87,14,"log"],[1,1983,87,18],[1,1994,87,29,"pendingLocations"],[1,1996,87,46,"length"],[1,2030,88,12,"locationAPI"],[1,2032,88,23,"locationAPI"],[1,2044,88,24,"createLocationsBatch"],[1,2065,88,45,"pendingLocations"],[1,2074,89,12,"storageService"],[1,2076,89,26,"storageService"],[1,2091,89,27,"clearPendingLocations"],[1,2115,90,6,"console"],[1,2123,90,14,"log"],[1,2127,90,18],[1,2159,91,4],[1,2160,91,6],[1,2166,91,13,"error"],[1,2169,92,6,"console"],[1,2177,92,14,"error"],[1,2183,92,20],[1,2210,92,48,"error"],[1,2212,93,4],[1,2213,94,2],[1,2216,98,0,"TaskManager"],[1,2218,98,12,"defineTask"],[1,2229,98,23,"LOCATION_TASK_NAME"],[1,2231,98,43,"async"],[1,2238,98,52,"data"],[1,2245,98,58,"error"],[1,2257,99,2],[1,2260,99,6,"error"],[1,2262,100,4,"console"],[1,2270,100,12,"error"],[1,2276,100,18],[1,2310,100,53,"error"],[1,2318,104,2],[1,2321,104,6,"data"],[1,2323,104,12],[1,2324,105,4],[1,2330,105,10,"locations"],[1,2340,105,12,"locations"],[1,2343,105,26,"data"],[1,2345,106,10,"user"],[1,2353,106,23,"storageService"],[1,2355,106,37,"storageService"],[1,2370,106,38,"getUser"],[1,2380,108,4],[1,2384,108,9,"user"],[1,2387,108,38],[1,2391,108,17,"locations"],[1,2393,108,27,"length"],[1,2400,108,41],[1,2407,110,4],[1,2413,110,10,"location"],[1,2415,110,21,"locations"],[1,2417,110,31],[1,2420,111,10,"locationData"],[1,2422,111,25],[1,2423,112,6,"user_id"],[1,2431,112,15,"user"],[1,2433,112,20,"id"],[1,2436,113,6,"latitude"],[1,2445,113,16,"location"],[1,2447,113,25,"coords"],[1,2454,113,32,"latitude"],[1,2463,114,6,"longitude"],[1,2473,114,17,"location"],[1,2475,114,26,"coords"],[1,2482,114,33,"longitude"],[1,2492,115,6,"timestamp"],[1,2502,115,17],[1,2506,115,21,"Date"],[1,2511,115,26,"location"],[1,2513,115,35,"timestamp"],[1,2524,115,46,"toISOString"],[1,2539,118,4],[1,2550,120,28,"NetInfo"],[1,2552,120,35,"default"],[1,2560,120,36,"fetch"],[1,2569,122,18,"isConnected"],[1,2588,124,14,"locationAPI"],[1,2590,124,25,"locationAPI"],[1,2602,124,26,"createLocation"],[1,2617,124,41,"locationData"],[1,2620,125,8,"console"],[1,2628,125,16,"log"],[1,2632,125,20],[1,2667,128,14,"storageService"],[1,2669,128,28,"storageService"],[1,2684,128,29,"savePendingLocation"],[1,2704,128,49,"locationData"],[1,2707,129,8,"console"],[1,2715,129,16,"log"],[1,2719,129,20],[1,2755,131,4],[1,2756,131,6],[1,2762,131,13,"error"],[1,2771,133,12,"storageService"],[1,2773,133,26,"storageService"],[1,2788,133,27,"savePendingLocation"],[1,2808,133,47,"locationData"],[1,2811,134,6,"console"],[1,2819,134,14,"error"],[1,2825,134,20],[1,2866,134,62,"error"],[1,2868,135,4],[1,2869,136,2],[1,2872,137,3],[1,2875]],"functionMap":{"names":["<global>","locationTrackingService.requestPermissions","locationTrackingService.startTracking","locationTrackingService.stopTracking","locationTrackingService.getCurrentLocation","locationTrackingService.syncPendingLocations","TaskManager.defineTask$argument_1"],"mappings":"AAA;ECU;GDY;EEE;GFuB;EGE;GHU;EIE;GJU;EKE;GLoB;2CMI;CNuC"},"hasCjsExports":false},"type":"js/module"}]}